name: Build APK
# 触发条件：当你提交代码 (push) 或者手动点击 (workflow_dispatch) 时触发
on: 
  push:
    branches: [ "main", "master" ]
  workflow_dispatch:

jobs:
  build-apk:
    runs-on: ubuntu-latest  # 使用 Linux 环境（纯英文路径，无坑！）

    steps:
      # 1. 拉取你的代码
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. 设置 Python 环境 (这里选 3.12 稳定版，避开你本地 3.14 的兼容性风险)
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
          architecture: 'x64'

      # 3. 安装 Flet 和其他依赖
      - name: Install Dependencies
        run: |
          pip install flet
          # 如果你有 requirements.txt，请取消下面这行的注释
          # pip install -r requirements.txt

      # 4. 开始打包 (GitHub 网络极快，几分钟就好)
      - name: Build APK
        run: flet build apk --verbose

      # 5. 上传打包好的 APK 供你下载
      - name: Upload Artifact
        uses: actions/upload-artifact@v3
        with:
          name: my-app-release
          path: build/apk/*.apk
